# 451 - d3e08d2 `bump vue` & 补上忘了添加进去的`mime-types`依赖

`mime-types`被`puppeteer`作为了依赖，可以正常使用，所以尤大并没有察觉。



# 452 - c40978f 简化`ws`代码 [#180](https://github.com/vitejs/vite/pull/180)

`ws`可以直接调用`clients`来获取正在连接的`ws`服务，同时可以通过`client.readyState`知道链接是否有效。

```typescript
const wss = new WebSocket.Server({ server })

wss.clients.forEach((client) => {
      if (client.readyState === WebSocket.OPEN) {
        client.send(stringified)
      }
    })
```



# 453 - 0cc57c8 为`css` & 主`chunk`添加hash

资源生成文件夹从`assets`更改为`_assets`。

现在为`css`、`dynamicimported chunk`和主`chunk`([444](https://github.com/Kingbultsea/vite-analysis/blob/b6617741425483652faf7447e5424fffa9d71b16/441-450/441-450.md#444---bdc7e70-%E6%B7%BB%E5%8A%A0shouldpreload%E5%9C%A8%E5%8F%AF%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9%E4%B8%AD%E5%8F%AF%E9%A2%84%E5%8A%A0%E8%BD%BD%E9%9D%9E%E4%B8%BBchunk%E8%B5%84%E6%BA%90-144) - 底部解释)添加名称hash。

[`output.chunkFileNames`](https://rollup.docschina.org/guide/en/#outputchunkfilenames): `dynamicimported chunk`，异步`chunk`。

[`output.entryFileNames`](https://rollup.docschina.org/guide/en/#outputentryfilenames): 入口chunk，主chunk。

```typescript
const { output } = await bundle.generate({
    format: 'es',
    sourcemap,
    entryFileNames: `[name].[hash].js`,
    chunkFileNames: `common.[hash].js`,
    ...rollupOutputOptions
  })

// 尤大是不是弄反了呢？认为异步chunk，以文件名称是最好的。
// 如下图的TestAsync.388b3ea8.js
```

![1](1.png)

>静态资源的文件hash已经在`buildPluginAssets.ts`被添加。
>
>`js`是`rollup`添加的`hash`，是内容`hash`。



# 454 - d16f567 fix [#160](https://github.com/vitejs/vite/issues/160) 支持`.html`路由跳转

不再写死`./index.html`。

> 构建的时候是写死... 我就看到时候谁反馈了。现在只解决了server。
>
> [426](https://github.com/Kingbultsea/vite-analysis/blob/da8c66f4dd50db3014bb9d01d6e5210fa0848646/421-430/421-430.md#426---a6a76a7-indexhtml%E6%94%AF%E6%8C%81hmr%E8%B0%83%E7%94%A8%E8%A7%A6%E5%8F%91full-reload)有提到。
>
> （通过rollup修改入口是可以，但是`createBuildHtmlPlugin`会无法读取到文件，也是行不通的）



# 455 - 