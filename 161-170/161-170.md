# commit-161 v0.9.1

release v0.9.1



# commit-162 changelog

## [0.9.1](https://github.com/vuejs/vite/compare/v0.9.0...v0.9.1) (2020-05-03)

### Bug Fixes

- 现在`readBody`方法可以返回为空的内容了 ([a83637e](https://github.com/vuejs/vite/commit/a83637e82c86df43edaf28e469bec6cbf6ad8b33))



# commit-163 fix `hmr`名称

`vue`的`hmr`: `style-update` -> `vue-style-update`

## `vue-style-update`和`style-update`有什么不一样？

```typescript
case 'vue-style-update':
      updateStyle(id, `${path}?type=style&index=${index}&t=${timestamp}`)
      console.log(
        `[vite] ${path} style${index > 0 ? `#${index}` : ``} updated.`
      )
      break
case 'style-update':
      updateStyle(id, `${path}?raw&t=${timestamp}`)
      console.log(`[vite] ${path} updated.`)

export function updateStyle(id: string, url: string) {
  const linkId = `vite-css-${id}`
  let link = document.getElementById(linkId)
  if (!link) {
    link = document.createElement('link')
    link.id = linkId
    link.setAttribute('rel', 'stylesheet')
    link.setAttribute('type', 'text/css')
    document.head.appendChild(link)
  }
  link.setAttribute('href', url)
}
```

可以看到并没什么不一样，区别的是名称与参数。



# commit-164 fix `isImportRequest` 取`pathname`

优化，去除请求域名。

```typescript
export const isImportRequest = (ctx: Context) => {
  const referer = new URL(ctx.get('referer')).pathname
  return /\.\w+$/.test(referer) && !referer.endsWith('.html')
}
```

## 关于`referer`的

不知道有没有小伙伴和我一样误解`referer`是浏览器当前页面的路径。

如果页面A，有脚本B，脚本B请求脚本C，那么C脚本的`referer`是脚本B，利用这个特性，我们服务器就可以知道这个是脚本发出的请求还是页面发出的请求了。



# commit-165 `json`引入添加`hmr`

啊哈，之前就觉得`json`需要加入`hmr`，现在加入了。

## `node/serverPluginJson.ts`

```typescript
watcher.on('change', (file) => {
    if (file.endsWith('.json')) {
      watcher.handleJSReload(file)
    }
  })
```

## node/utils.ts 添加`cleanUrl`方法



